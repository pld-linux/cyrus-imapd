--- cyrus-imapd-2.2.3/lib/Makefile.in.orig	2004-01-03 15:16:44.000000000 +0000
+++ cyrus-imapd-2.2.3/lib/Makefile.in	2004-03-14 14:48:11.000000000 +0000
@@ -43,10 +43,10 @@
 # $Id$
 
 # Authorization namespace.
-AUTH=auth_@WITH_AUTH@.o
+AUTH=auth_@WITH_AUTH@.lo
 
 # ACL interpretation.  Only one choice for now:
-ACL=acl_afs.o
+ACL=acl_afs.lo
 
 srcdir = @srcdir@
 VPATH = @srcdir@
@@ -55,6 +55,8 @@
 
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@
 CPPFLAGS = -I.. @CPPFLAGS@ @COM_ERR_CPPFLAGS@ @SASLFLAGS@
@@ -69,6 +71,7 @@
 prefix = @prefix@
 exec_prefix = @exec_prefix@
 cyrus_prefix = @cyrus_prefix@
+libdir = @libdir@
 
 BUILTSOURCES = imapopts.h imapopts.c
 
@@ -83,27 +86,26 @@
 	$(srcdir)/cyrusdb.h $(srcdir)/iptostring.h $(srcdir)/rfc822date.h \
 	$(srcdir)/libcyr_cfg.h
 
-LIBCYR_OBJS = acl.o bsearch.o charset.o glob.o retry.o util.o \
-	libcyr_cfg.o mkgmtime.o prot.o parseaddr.o imclient.o imparse.o \
-	lsort.o stristr.o rfc822date.o cyrusdb.o strhash.o \
-	chartable.o imapurl.o nonblock_@WITH_NONBLOCK@.o lock_@WITH_LOCK@.o \
-	gmtoff_@WITH_GMTOFF@.o map_@WITH_MAP@.o $(ACL) $(AUTH) \
-	@LIBOBJS@ @CYRUSDB_OBJS@ \
+LIBCYR_OBJS = acl.lo bsearch.lo charset.lo glob.lo retry.lo util.lo \
+	libcyr_cfg.lo mkgmtime.lo prot.lo parseaddr.lo imclient.lo imparse.lo \
+	lsort.lo stristr.lo rfc822date.lo cyrusdb.lo strhash.lo \
+	chartable.lo imapurl.lo nonblock_@WITH_NONBLOCK@.lo lock_@WITH_LOCK@.lo \
+	gmtoff_@WITH_GMTOFF@.lo map_@WITH_MAP@.lo $(ACL) $(AUTH) \
+	@LTLIBOBJS@ @CYRUSDB_OBJS@ \
 	iptostring.o xmalloc.o wildmat.o
 
 LIBCYRM_HDRS = $(srcdir)/hash.h $(srcdir)/mpool.h $(srcdir)/xmalloc.h \
 	$(srcdir)/strhash.o $(srcdir)/libconfig.h $(srcdir)/assert.h \
 	imapopts.h
-LIBCYRM_OBJS = libconfig.o imapopts.o hash.o mpool.o xmalloc.o strhash.o \
-	assert.o @IPV6_OBJS@
+LIBCYRM_OBJS = libconfig.lo imapopts.lo hash.lo mpool.lo xmalloc.lo strhash.lo \
+	assert.lo @IPV6_OBJS@
 
-all: $(BUILTSOURCES) libcyrus_min.a libcyrus.a
+all: $(BUILTSOURCES) libcyrus_min.la libcyrus.la
 
 install:
-	$(srcdir)/../install-sh -d $(DESTDIR)$(exec_prefix)/lib
-	$(INSTALL) -m 644 libcyrus.a $(DESTDIR)$(exec_prefix)/lib
-	$(INSTALL) -m 644 libcyrus_min.a $(DESTDIR)$(exec_prefix)/lib
-	$(RANLIB) $(DESTDIR)$(exec_prefix)/lib/libcyrus.a
+	$(srcdir)/../install-sh -d $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install $(INSTALL) libcyrus.la $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install $(INSTALL) libcyrus_min.la $(DESTDIR)$(libdir)
 	for file in $(LIBCYR_HDRS); \
 	do \
 		$(INSTALL) -m 644 $$file $(DESTDIR)$(prefix)/include/cyrus || exit 1; \
@@ -113,19 +115,15 @@
 		$(INSTALL) -m 644 $$file $(DESTDIR)$(prefix)/include/cyrus || exit 1; \
 	done
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I. $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile $(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I. $(CFLAGS) \
 	$<
 
-libcyrus.a: $(LIBCYR_OBJS)
-	rm -f libcyrus.a
-	ar cr libcyrus.a $(LIBCYR_OBJS)
-	$(RANLIB) libcyrus.a
-
-libcyrus_min.a: $(LIBCYRM_OBJS)
-	rm -f libcyrus_min.a
-	ar cr libcyrus_min.a $(LIBCYRM_OBJS)
-	$(RANLIB) libcyrus_min.a
+libcyrus.la: $(LIBCYR_OBJS)
+	$(LIBTOOL) --mode=link $(CC) -o libcyrus.la $(LIBCYR_OBJS) @LIBS@ @LIB_SASL@ -rpath $(libdir)
+
+libcyrus_min.la: $(LIBCYRM_OBJS)
+	$(LIBTOOL) --mode=link $(CC) -o libcyrus_min.la $(LIBCYRM_OBJS) @IMAP_COM_ERR_LIBS@ -rpath $(libdir)
 
 imapopts.c: imapoptions $(srcdir)/../tools/config2header
 	$(srcdir)/../tools/config2header $(srcdir)/imapopts.c $(srcdir)/imapopts.h < $(srcdir)/imapoptions
--- cyrus-imapd-2.2.3/man/Makefile.in.orig	2004-03-02 22:00:32.000000000 +0000
+++ cyrus-imapd-2.2.3/man/Makefile.in	2004-03-14 14:35:32.000000000 +0000
@@ -52,7 +52,7 @@
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../et @CPPFLAGS@ 
 LIBS = @LIBS@ 
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = -g
 LDFLAGS = -g
--- cyrus-imapd-2.2.3/imap/Makefile.in.orig	2003-11-12 04:02:01.000000000 +0000
+++ cyrus-imapd-2.2.3/imap/Makefile.in	2004-03-14 14:41:46.000000000 +0000
@@ -56,6 +56,8 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 AWK = @AWK@
 
 CYRUS_USER=@cyrus_user@
@@ -68,7 +70,7 @@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = $(IMAP_LIBS) $(IMAP_COM_ERR_LIBS)
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@ @COM_ERR_LDFLAGS@ 
@@ -135,7 +137,7 @@
 	$(srcdir)/../install-sh -d ${DESTDIR}$(service_path)
 	for file in $(PROGS); \
 	do \
-		$(INSTALL) -m 755 $$file $(DESTDIR)$(service_path) || exit 1; \
+		$(LIBTOOL) --mode=install $(INSTALL) $$file $(DESTDIR)$(service_path) || exit 1; \
 	done
 	ln -f $(DESTDIR)$(service_path)/pop3d $(DESTDIR)$(service_path)/pop3proxyd
 
@@ -185,156 +187,156 @@
 
 ### Services
 idled: idled.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o idled \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o idled \
 	 idled.o mutex_fake.o libimap.a $(DEPLIBS) $(LIBS)
 
 lmtpd: lmtpd.o $(LMTPOBJS) mutex_fake.o libimap.a $(SIEVE_LIBS) \
 	$(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o lmtpd \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o lmtpd \
 	 $(SERVICE) lmtpd.o $(LMTPOBJS) mutex_fake.o \
 	 libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 lmtpd.pure: lmtpd.o $(LMTPOBJS) mutex_fake.o \
 	libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o lmtpd.pure \
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o lmtpd.pure \
 	 $(SERVICE) lmtpd.o $(LMTPOBJS) mutex_fake.o \
 	 libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 lmtpproxyd: lmtpproxyd.o $(LMTPOBJS) mutex_fake.o \
 	libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o lmtpproxyd \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o lmtpproxyd \
 	 $(SERVICE) lmtpproxyd.o $(LMTPOBJS) mutex_fake.o \
 	 libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 lmtpproxyd.pure: lmtpproxyd.o $(LMTPOBJS) mutex_fake.o \
 	libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o lmtpproxyd.pure \
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o lmtpproxyd.pure \
 	 $(SERVICE) lmtpproxyd.o $(LMTPOBJS) mutex_fake.o \
 	 libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 imapd: xversion $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o imapd \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o imapd \
 	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o \
 	libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 imapd.pure: $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o imapd.pure \
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o imapd.pure \
 	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o libimap.a \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 imapd.quant: $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(QUANTIFY) $(QUANTOPT) $(CC) $(LDFLAGS) -o imapd.quant \
+	$(QUANTIFY) $(QUANTOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o imapd.quant \
 	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o libimap.a \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 proxyd: $(PROXYDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o proxyd \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o proxyd \
 	 $(SERVICE) $(PROXYDOBJS) mutex_fake.o libimap.a \
 	 $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 proxyd.pure: $(PROXYDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o proxyd.pure \
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o proxyd.pure \
 	 $(SERVICE) $(PROXYDOBJS) mutex_fake.o libimap.a \
 	 $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 mupdate: mupdate.o mupdate-slave.o mupdate-client.o mutex_pthread.o tls.o \
 	libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o mupdate \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o mupdate \
 	 $(SERVICETHREAD) mupdate.o mupdate-slave.o mupdate-client.o \
 	 mutex_pthread.o tls.o libimap.a \
 	 $(DEPLIBS) $(LIBS) $(LIB_WRAP) -lpthread
 
 mupdate.pure: mupdate.o mupdate-slave.o mupdate-client.o mutex_pthread.o \
 	libimap.a $(DEPLIBS)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o mupdate.pure \
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o mupdate.pure \
 	 $(SERVICETHREAD) mupdate.o mupdate-slave.o mupdate-client.o \
 	 mutex_pthread.o libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP) -lpthread
 
 pop3d: pop3d.o backend.o tls.o mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o pop3d pop3d.o backend.o tls.o $(SERVICE) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o pop3d pop3d.o backend.o tls.o $(SERVICE) \
 	 mutex_fake.o libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 nntpd: nntpd.o backend.o index.o smtpclient.o spool.o tls.o \
 	 mutex_fake.o nntp_err.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o nntpd nntpd.o backend.o index.o spool.o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o nntpd nntpd.o backend.o index.o spool.o \
 	 smtpclient.o tls.o $(SERVICE) mutex_fake.o nntp_err.o \
 	 libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 fud: fud.o libimap.a mutex_fake.o $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o fud $(SERVICE) fud.o mutex_fake.o libimap.a \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o fud $(SERVICE) fud.o mutex_fake.o libimap.a \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 smmapd: smmapd.o libimap.a mutex_fake.o $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o smmapd $(SERVICE) smmapd.o mutex_fake.o libimap.a \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o smmapd $(SERVICE) smmapd.o mutex_fake.o libimap.a \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 ### Command Line Utilities
 arbitron: arbitron.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o arbitron arbitron.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o arbitron arbitron.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 cvt_cyrusdb: cvt_cyrusdb.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cvt_cyrusdb cvt_cyrusdb.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o cvt_cyrusdb cvt_cyrusdb.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 chk_cyrus: chk_cyrus.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o chk_cyrus chk_cyrus.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o chk_cyrus chk_cyrus.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 deliver: deliver.o $(LMTPOBJS) mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o deliver deliver.o $(LMTPOBJS) mutex_fake.o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o deliver deliver.o $(LMTPOBJS) mutex_fake.o \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 ctl_deliver: ctl_deliver.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 $@ ctl_deliver.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 ctl_mboxlist: ctl_mboxlist.o mupdate-client.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ ctl_mboxlist.o mupdate-client.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ctl_mboxlist.o mupdate-client.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 ctl_cyrusdb: ctl_cyrusdb.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 $@ ctl_cyrusdb.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 cyr_expire: cyr_expire.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ cyr_expire.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ cyr_expire.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 fetchnews: fetchnews.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 $@ fetchnews.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 squatter: squatter.o index.o squat_build.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o squatter squatter.o index.o squat_build.o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o squatter squatter.o index.o squat_build.o \
 	$(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 mbpath: mbpath.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o mbpath mbpath.o $(CLIOBJS) libimap.a \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o mbpath mbpath.o $(CLIOBJS) libimap.a \
 	$(DEPLIBS) $(LIBS)
 
 ipurge: ipurge.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o ipurge ipurge.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o ipurge ipurge.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 cyrdump: cyrdump.o index.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cyrdump cyrdump.o index.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o cyrdump cyrdump.o index.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 mbexamine: mbexamine.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 mbexamine mbexamine.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 reconstruct: reconstruct.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 reconstruct reconstruct.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 quota: quota.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o quota quota.o $(CLIOBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o quota quota.o $(CLIOBJS) \
 	libimap.a $(DEPLIBS) $(LIBS)
 
 tls_prune: tls_prune.o tls.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o \
 	 $@ tls_prune.o tls.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
 
 ### Other Misc Targets
--- cyrus-imapd-2.2.3/perl/imap/Makefile.PL.orig	2003-10-22 18:50:18.000000000 +0000
+++ cyrus-imapd-2.2.3/perl/imap/Makefile.PL	2004-03-14 14:45:00.000000000 +0000
@@ -64,8 +64,7 @@
     'macro'	=> {'IMCLIENT_LIBS' => ''},	# hack
     'clean'	=> {'FILES' => 'libcyrperl.a cyradm'},
     'OBJECT'    => 'IMAP.o',
-    'MYEXTLIB'  => '../../lib/libcyrus.a ../../lib/libcyrus_min.a',
-    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto"],
+    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto -L../../lib/.libs -lcyrus -lcyrus_min"],
     'DEFINE'	=> '-DPERL_POLLUTE',     # e.g., '-DHAVE_SOMETHING' 
     'INC'	=> "-I../../lib $SASL_INC $OPENSSL_INC", 
     'EXE_FILES' => [cyradm],
--- cyrus-imapd-2.2.3/perl/sieve/lib/Makefile.in.orig	2004-01-03 15:16:45.000000000 +0000
+++ cyrus-imapd-2.2.3/perl/sieve/lib/Makefile.in	2004-03-14 14:47:42.000000000 +0000
@@ -48,15 +48,17 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@ -Dbool=char -DHAS_BOOL
 CPPFLAGS = -I. -I../../.. -I$(srcdir) -I$(srcdir)/../../../lib @CPPFLAGS@ @DYNSASLFLAGS@
-LIBS = ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a @LIB_DYN_SASL@ @LIBS@
+LIBS = ../../../lib/libcyrus.la ../../../lib/libcyrus_min.la @LIB_DYN_SASL@ @LIBS@
 IMAP_LIBS = @IMAP_LIBS@
-DEPLIBS = ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../../../lib/libcyrus.la ../../../lib/libcyrus_min.la @DEPLIBS@
 
-CFLAGS = -g
-LDFLAGS = -g @LDFLAGS@
+CFLAGS = @CFLAGS@
+LDFLAGS = @LDFLAGS@
 
 SHELL = /bin/sh
 MAKEDEPEND = @MAKEDEPEND@
@@ -65,19 +67,17 @@
 exec_prefix = @exec_prefix@
 cyrus_prefix = @cyrus_prefix@
 
-OBJS=isieve.o lex.o mystring.o request.o
+OBJS=isieve.lo lex.lo mystring.lo request.lo
 
-all: libisieve.a
+all: libisieve.la
 
 install:
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
-libisieve.a: $(OBJS)
-	rm -f libisieve.a
-	ar cr libisieve.a $(OBJS)
-	$(RANLIB) libisieve.a
+libisieve.la: $(OBJS)
+	$(LIBTOOL) --mode=link $(CC) -o libisievie.la $(OBJS)
 
 clean:
 	rm -f *.o Makefile.bak makedepend.log libisieve.a
--- cyrus-imapd-2.2.3/perl/sieve/managesieve/Makefile.PL.orig	2003-10-22 18:50:27.000000000 +0000
+++ cyrus-imapd-2.2.3/perl/sieve/managesieve/Makefile.PL	2004-03-14 14:50:22.000000000 +0000
@@ -59,7 +59,7 @@
     'NAME'	=> 'Cyrus::SIEVE::managesieve',
     'ABSTRACT'  => 'Cyurs Sieve management interface',
     'VERSION_FROM' => 'managesieve.pm', # finds $VERSION
-    'MYEXTLIB'  => '../lib/isieve.o ../lib/lex.o ../lib/mystring.o ../lib/request.o ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a',
-    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto"], 
+    'MYEXTLIB'  => '../lib/.libs/isieve.o ../lib/.libs/lex.o ../lib/.libs/mystring.o ../lib/.libs/request.o',
+    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto -L../../../lib/.libs -lcyrus -lcyrus_min"], 
     'DEFINE'	=> '-DPERL_POLLUTE',     # e.g., '-DHAVE_SOMETHING' 
     'INC'	=> "-I../lib/ -I../../../lib/ $SASL_INC $OPENSSL_INC",
--- cyrus-imapd-2.2.3/depot/Makefile.in.orig	2003-10-22 18:02:51.000000000 +0000
+++ cyrus-imapd-2.2.3/depot/Makefile.in	2004-03-14 14:50:48.000000000 +0000
@@ -49,7 +49,7 @@
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../et @CPPFLAGS@ 
 LIBS = @LIBS@ 
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = -g
 LDFLAGS = -g
--- cyrus-imapd-2.2.3/sieve/Makefile.in.orig	2003-11-12 04:02:12.000000000 +0000
+++ cyrus-imapd-2.2.3/sieve/Makefile.in	2004-03-14 14:52:53.000000000 +0000
@@ -34,6 +34,8 @@
 YFLAGS = -d
 LEX = @LEX@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 COMPILE_ET = @COMPILE_ET@
 
 DEFS = @DEFS@
@@ -47,7 +49,7 @@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
 LIBS = libsieve.a $(IMAP_LIBS) $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS=../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 BUILT_SOURCES = addr.c addr.h addr-lex.c \
 	sieve.c sieve.h sieve-lex.c \
@@ -59,10 +61,10 @@
 
 install: sievec
 	$(srcdir)/../install-sh -d ${DESTDIR}$(service_path)
-	$(srcdir)/../install-sh -m 755 sievec $(DESTDIR)$(service_path) || exit
+	$(LIBTOOL) --mode=install $(srcdir)/../install-sh sievec $(DESTDIR)$(service_path) || exit
 
 test: $(DEPLIBS) libsieve.a test.o
-	$(CC) $(LDFLAGS) -o test test.o libsieve.a $(DEPLIBS) $(LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o test test.o libsieve.a $(DEPLIBS) $(LIBS)
 
 OBJS = sieve_err.o \
        sieve.o sieve-lex.o comparator.o interp.o message.o \
@@ -100,10 +102,10 @@
 	$(RANLIB) libsieve.a
 
 sievec: sievec.o libsieve.a
-	$(CC) $(LDFLAGS) -o sievec sievec.o libsieve.a $(DEPLIBS) $(LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o sievec sievec.o libsieve.a $(DEPLIBS) $(LIBS)
 
 sieved: sieved.o libsieve.a
-	$(CC) $(LDFLAGS) -o sieved sieved.o libsieve.a $(DEPLIBS) $(LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o sieved sieved.o libsieve.a $(DEPLIBS) $(LIBS)
 
 
 sieve_interface.h: sieve_err.h
--- cyrus-imapd-2.2.3/timsieved/Makefile.in.orig	2003-11-12 04:02:14.000000000 +0000
+++ cyrus-imapd-2.2.3/timsieved/Makefile.in	2004-03-14 14:54:40.000000000 +0000
@@ -46,6 +46,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 INSTALL = @INSTALL@
 CYRUS_USER=@cyrus_user@
@@ -71,7 +73,7 @@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../sieve/libsieve.a ../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS=../sieve/libsieve.a ../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 PURIFY=/usr/local/bin/purify
 PUREOPT=-best-effort
@@ -79,18 +81,18 @@
 all: timsieved
 
 install:
-	$(INSTALL) -m 755 timsieved $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) timsieved $(DESTDIR)$(service_path)
 
 OBJS= actions.o lex.o mystring.o scripttest.o timsieved.o parser.o \
 	../imap/tls.o
 
 timsieved: $(OBJS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o timsieved \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o timsieved \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 timsieved.pure: $(OBJS) $(SERVICE)
 	$(PURIFY) $(PUREOPT) \
-	$(CC) $(LDFLAGS) -o timsieved.pure \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o timsieved.pure \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 clean:
--- cyrus-imapd-2.2.3/installsieve/Makefile.in.orig	2003-10-22 18:50:11.000000000 +0000
+++ cyrus-imapd-2.2.3/installsieve/Makefile.in	2004-03-14 14:55:58.000000000 +0000
@@ -45,6 +45,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir) -I$(srcdir)/../lib @CPPFLAGS@ @SASLFLAGS@
@@ -57,7 +59,7 @@
 
 IMAP_LIBS = @IMAP_LIBS@
 LIBS = 
-DEPLIBS= ../lib/libcyrus.a @DEPLIBS@
+DEPLIBS= ../lib/libcyrus.la @DEPLIBS@
 
 prefix = @prefix@
 exec_prefix = @exec_prefix@
@@ -66,7 +68,7 @@
 all: installsieve
 
 install:
-	$(INSTALL) -s -m 755 installsieve $(DESTDIR)$(exec_prefix)/bin
+	$(LIBTOOL) --mode=install $(INSTALL) installsieve $(DESTDIR)$(exec_prefix)/bin
 
 OBJS=lex.o mystring.o request.o isieve.o
 
@@ -76,7 +78,7 @@
 	$(RANLIB) libinstallsieve.a
 
 installsieve: libinstallsieve.a installscript.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o installsieve libinstallsieve.a installscript.o $(DEPLIBS) $(IMAP_LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o installsieve libinstallsieve.a installscript.o $(DEPLIBS) $(IMAP_LIBS)
 
 clean:
 	rm -f *.o *.a Makefile.bak makedepend.log
--- cyrus-imapd-2.2.3/netnews/Makefile.in.orig	2003-11-12 04:02:08.000000000 +0000
+++ cyrus-imapd-2.2.3/netnews/Makefile.in	2004-03-14 14:57:58.000000000 +0000
@@ -47,11 +47,13 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I.. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../et @CPPFLAGS@
 LIBS =  @IMAP_LIBS@ @LIB_RT@
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@ 
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@ 
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -69,13 +71,13 @@
 all: remotepurge
 
 install:
-	$(INSTALL) -s -m 755 remotepurge $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) remotepurge $(DESTDIR)$(service_path)
 
 .c.o:
 	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
 remotepurge: $(OBJS) $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o remotepurge $(OBJS) \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o remotepurge $(OBJS) \
 		$(DEPLIBS) $(LIBS)
 
 
--- cyrus-imapd-2.2.3/configure.in.orig	2004-03-02 22:00:32.000000000 +0000
+++ cyrus-imapd-2.2.3/configure.in	2004-03-14 14:34:05.000000000 +0000
@@ -89,7 +89,7 @@
 AC_DEFINE_UNQUOTED(SYSCONFDIR,"$sysconfdir",[Config File Location])
 
 AC_PROG_CC
-AC_PROG_RANLIB
+AC_PROG_LIBTOOL
 AC_PROG_MAKE_SET
 AC_PROG_INSTALL
 AC_AIX
@@ -123,7 +123,7 @@
 	cyrus_cv_getaddrinfo=no)], cyrus_cv_getaddrinfo=no)
 
 if test $cyrus_cv_getaddrinfo = no; then
-	IPV6_OBJS="getaddrinfo.o"
+	IPV6_OBJS="getaddrinfo.lo"
 fi
 
 cyrus_cv_getnameinfo=yes
@@ -132,7 +132,7 @@
 	cyrus_cv_getnameinfo=no)
 
 if test $cyrus_cv_getnameinfo = no; then
-	IPV6_OBJS="$IPV6_OBJS getnameinfo.o"
+	IPV6_OBJS="$IPV6_OBJS getnameinfo.lo"
 fi
 
 IPv6_CHECK_SS_FAMILY()
@@ -166,7 +166,7 @@
 dnl function for doing each of the database backends
 dnl parameters: backend name, variable to set, withval
 
-CYRUSDB_OBJS="cyrusdb_flat.o cyrusdb_skiplist.o"
+CYRUSDB_OBJS="cyrusdb_flat.lo cyrusdb_skiplist.lo"
 
 dnl Berkeley DB Detection
 
@@ -213,7 +213,7 @@
   LIBS="${LIBS} ${BDB_LIBADD}"
   CPPFLAGS="${BDB_INCADD} ${CPPFLAGS}"
 
-  CYRUSDB_OBJS="$CYRUSDB_OBJS cyrusdb_berkeley.o"
+  CYRUSDB_OBJS="$CYRUSDB_OBJS cyrusdb_berkeley.lo"
   AC_DEFINE(HAVE_BDB,[],[Build in Berkeley DB support?])
 fi
 
--- cyrus-imapd-2.2.3/imtest/Makefile.in.orig	2004-01-03 15:16:43.000000000 +0000
+++ cyrus-imapd-2.2.3/imtest/Makefile.in	2004-03-14 15:00:16.000000000 +0000
@@ -48,15 +48,17 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@
 CPPFLAGS = -I. -I.. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../et @CPPFLAGS@  @SASLFLAGS@
 LIBS = @LIBS@ 
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
-CFLAGS = -g
-LDFLAGS = -g @LDFLAGS@
+CFLAGS = @CFLAGS@
+LDFLAGS = @LDFLAGS@
 
 SHELL = /bin/sh
 MAKEDEPEND = @MAKEDEPEND@
@@ -71,7 +73,7 @@
 all: imtest
 
 install:
-	$(INSTALL) -s -m 755 imtest $(DESTDIR)$(exec_prefix)/bin
+	$(LIBTOOL) --mode=install $(INSTALL) imtest $(DESTDIR)$(exec_prefix)/bin
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/pop3test
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/nntptest
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/lmtptest
@@ -83,10 +85,10 @@
 	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
 imtest: imtest.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o imtest imtest.o $(DEPLIBS) $(IMAP_LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o imtest imtest.o $(DEPLIBS) $(IMAP_LIBS)
 
 imtest.pure: imtest.o $(DEPLIBS)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o imtest $(OBJS) $(DEPLIBS) $(LIBS) $(IMAP_LIBS)
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o imtest $(OBJS) $(DEPLIBS) $(LIBS) $(IMAP_LIBS)
 
 clean:
 	rm -f *.o Makefile.bak makedepend.log imtest
--- cyrus-imapd-2.2.3/master/Makefile.in.orig	2003-11-12 04:02:03.000000000 +0000
+++ cyrus-imapd-2.2.3/master/Makefile.in	2004-03-14 15:01:44.000000000 +0000
@@ -48,6 +48,8 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 CYRUS_USER=@cyrus_user@
 CYRUS_GROUP=@cyrus_group@
@@ -58,7 +60,7 @@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@ @COM_ERR_LDFLAGS@
-LIBS = ../lib/libcyrus_min.a @LIB_UCDSNMP@ @LIBS@ @COM_ERR_LIBS@
+LIBS = ../lib/libcyrus_min.la @LIB_UCDSNMP@ @LIBS@ @COM_ERR_LIBS@
 
 SHELL = /bin/sh
 MAKEDEPEND = @MAKEDEPEND@
@@ -78,7 +80,7 @@
 	$(srcdir)/../install-sh -d ${DESTDIR}$(service_path)
 	for file in $(PROGS); \
 	do \
-		$(INSTALL) -m 755 $$file $(DESTDIR)$(service_path) || exit 1; \
+		$(LIBTOOL) --mode=install $(INSTALL) $$file $(DESTDIR)$(service_path) || exit 1; \
 	done
 
 .c.o:
@@ -86,7 +88,7 @@
 	$<
 
 master: master.o masterconf.o cyrusMasterMIB.o ../lib/lock_@WITH_LOCK@.o
-	$(CC) $(LDFLAGS) -o master master.o masterconf.o cyrusMasterMIB.o ../lib/lock_@WITH_LOCK@.o $(LIBS) $(DEPLIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o master master.o masterconf.o cyrusMasterMIB.o ../lib/lock_@WITH_LOCK@.o $(LIBS) $(DEPLIBS)
 
 clean:
 	rm -f *.o *.a Makefile.bak $(PROGS)
--- cyrus-imapd-2.2.3/notifyd/Makefile.in.orig	2003-11-12 04:02:10.000000000 +0000
+++ cyrus-imapd-2.2.3/notifyd/Makefile.in	2004-03-14 15:03:34.000000000 +0000
@@ -46,6 +46,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 INSTALL = @INSTALL@
 CYRUS_USER=@cyrus_user@
@@ -71,7 +73,7 @@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = @ZEPHYR_LIBS@ @LIBS@ $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS=../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 PURIFY=/usr/local/bin/purify
 PUREOPT=-best-effort
@@ -79,21 +81,21 @@
 all: notifyd
 
 install:
-	$(INSTALL) -m 755 notifyd $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) notifyd $(DESTDIR)$(service_path)
 
 OBJS= notifyd.o notify_null.o notify_log.o notify_mailto.o notify_zephyr.o
 
 notifytest: notifytest.o
-	$(CC) $(LDFLAGS) -o notifytest \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o notifytest \
 	 notifytest.o $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 notifyd: $(OBJS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o notifyd \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o notifyd \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 notifyd.pure: $(OBJS) $(SERVICE)
 	$(PURIFY) $(PUREOPT) \
-	$(CC) $(LDFLAGS) -o notifyd.pure \
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o notifyd.pure \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 clean:
--- cyrus-imapd-2.2.3/ptclient/Makefile.in.orig	2003-11-12 04:02:11.000000000 +0000
+++ cyrus-imapd-2.2.3/ptclient/Makefile.in	2004-03-14 15:05:38.000000000 +0000
@@ -50,6 +50,8 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I.. -I$(srcdir)/../imap -I$(srcdir)/../lib @COM_ERR_CPPFLAGS@ @CPPFLAGS@
@@ -59,7 +61,7 @@
 LIBS = $(IMAP_LIBS) @COM_ERR_LIBS@
 LIB_SASL = @LIB_SASL@
 LIB_WRAP = @LIB_WRAP@
-DEPLIBS = ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../imap/libimap.a ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 UTIL_LIBS = ../imap/mutex_fake.o ../imap/cli_fatal.o
 
 LDAP_LIBS=@LDAP_LIBS@
@@ -88,33 +90,33 @@
 all: $(PROGS)
 
 install:
-	$(INSTALL) -m 755 ptloader $(DESTDIR)$(service_path)
-	$(INSTALL) -m 755 ptexpire $(DESTDIR)$(service_path)
-	$(INSTALL) -m 755 ptdump $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptloader $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptexpire $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptdump $(DESTDIR)$(service_path)
 
 .c.o:
 	$(CC) -c $(CPPFLAGS) $(LDAP_CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
 ptloader: ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptloader.pure: ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(DEPLIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptloader.o @WITH_PTS@.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptexpire: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptexpire.pure: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptdump: ptdump.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptdump.pure: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
 ptextract: ptextract.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptextract.o $(UTIL_LIBS) $(DEPLIBS) $(LIBS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ ptextract.o $(UTIL_LIBS) $(DEPLIBS) $(LIBS)
 
 clean:
 	rm -f *.o Makefile.bak $(PROGS) makedepend.log
--- cyrus-imapd-2.2.3/sieve/sieved.c.orig	2003-10-22 18:03:25.000000000 +0000
+++ cyrus-imapd-2.2.3/sieve/sieved.c	2004-03-14 15:54:34.000000000 +0000
@@ -48,6 +48,9 @@
 /* from bc_eval.c */
 int unwrap_string(bytecode_input_t *bc, int pos, const char **str, int *len);
 
+/* config.c stuff */
+const int config_need_data = 0;
+
 /*this is called by xmalloc*/
 void fatal(const char *s, int code)
 {  
--- cyrus-imapd-2.2.3/imtest/imtest.c.orig	2004-01-03 15:14:29.000000000 +0000
+++ cyrus-imapd-2.2.3/imtest/imtest.c	2004-03-14 16:20:47.000000000 +0000
@@ -268,6 +268,9 @@
     imtest_fatal(msg);
 }
 
+/* config.c stuff */
+const int config_need_data = 0;
+
 int mysasl_config(void *context __attribute__((unused)), 
 		  const char *plugin_name,
 		  const char *option,
--- cyrus-imapd-2.2.3/perl/imap/IMAP.xs.orig	2003-11-25 21:28:23.000000000 +0000
+++ cyrus-imapd-2.2.3/perl/imap/IMAP.xs	2004-03-14 17:13:48.000000000 +0000
@@ -74,6 +74,7 @@
 {
   croak(s);
 }
+const int config_need_data = 0;
 
 /*
  * Decrement the refcounts of the Perl SV's in the passed rock, then free the
--- cyrus-imapd-2.2.3/perl/sieve/managesieve/managesieve.xs.orig	2003-10-22 18:50:27.000000000 +0000
+++ cyrus-imapd-2.2.3/perl/sieve/managesieve/managesieve.xs	2004-03-14 17:12:50.000000000 +0000
@@ -96,6 +96,7 @@
     croak("failure: %s", s);
     exit(-1);
 }
+const int config_need_data = 0;
 
 static int
 perlsieve_getpass(conn, context, id, psecret)
