--- cyrus-imapd-2.3.12p2.shared/configure.in	2008-09-23 21:44:50.591844716 +0300
+++ cyrus-imapd-2.3.12p2/configure.in	2008-09-23 22:25:22.672454302 +0300
@@ -87,7 +87,7 @@
 AC_DEFINE_UNQUOTED(SYSCONFDIR,"$sysconfdir",[Config File Location])
 
 AC_PROG_CC
-AC_PROG_RANLIB
+AC_PROG_LIBTOOL
 AC_PROG_MAKE_SET
 AC_PROG_INSTALL
 AC_AIX
@@ -133,7 +133,7 @@
 	cyrus_cv_getaddrinfo=no)], cyrus_cv_getaddrinfo=no)
 
 if test $cyrus_cv_getaddrinfo = no; then
-	IPV6_OBJS="getaddrinfo.o"
+	IPV6_OBJS="getaddrinfo.lo"
 fi
 
 cyrus_cv_getnameinfo=yes
@@ -142,7 +142,7 @@
 	cyrus_cv_getnameinfo=no)
 
 if test $cyrus_cv_getnameinfo = no; then
-	IPV6_OBJS="$IPV6_OBJS getnameinfo.o"
+	IPV6_OBJS="$IPV6_OBJS getnameinfo.lo"
 fi
 
 IPv6_CHECK_SS_FAMILY()
@@ -166,7 +166,7 @@
 dnl function for doing each of the database backends
 dnl parameters: backend name, variable to set, withval
 
-CYRUSDB_OBJS="cyrusdb_flat.o cyrusdb_skiplist.o cyrusdb_quotalegacy.o"
+CYRUSDB_OBJS="cyrusdb_flat.lo cyrusdb_skiplist.lo cyrusdb_quotalegacy.lo"
 
 dnl Berkeley DB Detection
 
@@ -213,7 +213,7 @@
   LIBS="${LIBS} ${BDB_LIBADD}"
   CPPFLAGS="${BDB_INCADD} ${CPPFLAGS}"
 
-  CYRUSDB_OBJS="$CYRUSDB_OBJS cyrusdb_berkeley.o"
+  CYRUSDB_OBJS="$CYRUSDB_OBJS cyrusdb_berkeley.lo"
   AC_DEFINE(HAVE_BDB,[],[Build in Berkeley DB support?])
 fi
 
@@ -230,9 +230,9 @@
 	fi)
 
 if test "$sievedir" != "no"; then
-	SIEVE_OBJS="lmtp_sieve.o smtpclient.o"
+	SIEVE_OBJS="lmtp_sieve.lo smtpclient.lo"
 	AC_SUBST(SIEVE_OBJS)
-	SIEVE_LIBS="../${sievedir}/libsieve.a"
+	SIEVE_LIBS="../${sievedir}/libsieve.la"
 	AC_SUBST(SIEVE_LIBS)
 	SIEVE_CPPFLAGS="-I\$(srcdir)/../$sievedir"
 	AC_SUBST(SIEVE_CPPFLAGS)
@@ -914,7 +914,7 @@
 if test $cyrus_cv_lib_syslog = no; then
 	PRE_SUBDIRS="${PRE_SUBDIRS} syslog"
 	EXTRA_OUTPUT="${EXTRA_OUTPUT} syslog/Makefile"
-	DEPLIBS="${DEPLIBS} ../syslog/libsyslog.a"
+	DEPLIBS="${DEPLIBS} ../syslog/libsyslog.la"
 	CPPFLAGS="$CPPFLAGS -I\$(srcdir)/../syslog"
 fi
 AC_MSG_RESULT($cyrus_cv_lib_syslog)
@@ -1010,7 +1010,7 @@
 dnl Check for MD5 functions
 AC_FUNC_CHECK(MD5Init,,
        AC_CHECK_LIB(md, MD5Init, LIBS="${LIBS} -lmd",
-                    MD5OBJ="md5.o"))
+                    MD5OBJ="md5.lo"))
 AC_SUBST(MD5OBJ)
 
 dnl snmp
--- cyrus-imapd-2.3.12p2.shared/depot/Makefile.in	2008-09-23 21:44:50.599845178 +0300
+++ cyrus-imapd-2.3.12p2/depot/Makefile.in	2008-09-23 22:10:04.419383504 +0300
@@ -44,16 +44,18 @@
 # $Id$
 
 srcdir = @srcdir@
+top_builddir = @top_builddir@
 VPATH = @srcdir@
 
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
 
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../et @CPPFLAGS@ 
 LIBS = @LIBS@ 
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -73,11 +75,11 @@
 	$(INSTALL) -m 644 $(srcdir)/rc.local.imap $(DESTDIR)etc
 	$(INSTALL) -m 644 $(srcdir)/rc.local.ptclient $(DESTDIR)etc
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
 clean:
-	rm -f *.o Makefile.bak makedepend.log
+	rm -rf .libs *.o *.lo Makefile.bak makedepend.log
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/imap/Makefile.in	2008-04-04 00:09:51.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/imap/Makefile.in	2008-09-23 21:44:50.591844716 +0300
@@ -45,16 +45,18 @@
 
 # \Seen state database.  Either 'db' (berkeley db) or 
 # 'local' (legacy flat file).
-SEEN=seen_db.o
+SEEN=seen_db.lo
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
+top_builddir = @top_builddir@
 VPATH = @srcdir@
 
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
 AWK = @AWK@
+LIBTOOL = @LIBTOOL@
 
 CYRUS_USER=@cyrus_user@
 CYRUS_GROUP=@cyrus_group@
@@ -67,7 +69,7 @@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = $(IMAP_LIBS) $(IMAP_COM_ERR_LIBS)
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@ @COM_ERR_LDFLAGS@ 
@@ -96,23 +98,23 @@
 cyrus_prefix = @cyrus_prefix@
 service_path = @service_path@
 
-LOBJS= append.o mailbox.o mboxlist.o mupdate-client.o mboxname.o message.o \
-	global.o imap_err.o mupdate_err.o proc.o setproctitle.o \
-	convert_code.o duplicate.o saslclient.o saslserver.o signals.o \
-	annotate.o search_engines.o squat.o squat_internal.o mbdump.o \
-	imapparse.o telemetry.o user.o notify.o idle.o quota_db.o \
-	sync_log.o $(SEEN) mboxkey.o backend.o tls.o message_guid.o \
-	statuscache_db.o
+LOBJS= append.lo mailbox.lo mboxlist.lo mupdate-client.lo mboxname.lo message.lo \
+	global.lo imap_err.lo mupdate_err.lo proc.lo setproctitle.lo \
+	convert_code.lo duplicate.lo saslclient.lo saslserver.lo signals.lo \
+	annotate.lo search_engines.lo squat.lo squat_internal.lo mbdump.lo \
+	imapparse.lo telemetry.lo user.lo notify.lo idle.lo quota_db.lo \
+	sync_log.lo $(SEEN) mboxkey.lo backend.lo tls.lo message_guid.lo \
+	statuscache_db.lo
 
-IMAPDOBJS=pushstats.o imapd.o proxy.o imap_proxy.o index.o version.o
+IMAPDOBJS=pushstats.lo imapd.lo proxy.lo imap_proxy.lo index.lo version.lo
 
-LMTPOBJS=lmtpstats.o lmtpengine.o spool.o
+LMTPOBJS=lmtpstats.lo lmtpengine.lo spool.lo
 
 # Your typical objects for the command line utilities
-CLIOBJS=cli_fatal.o mutex_fake.o
+CLIOBJS=cli_fatal.lo mutex_fake.lo
 
-SERVICE=../master/service.o
-SERVICETHREAD=../master/service-thread.o
+SERVICE=../master/service.lo
+SERVICETHREAD=../master/service-thread.lo
 
 PROGS = imapd lmtpd pop3d \
 	fud smmapd reconstruct quota mbpath ipurge cyr_dbtool cyr_synclog \
@@ -139,23 +141,21 @@
 	ln -f $(DESTDIR)$(service_path)/imapd $(DESTDIR)$(service_path)/proxyd
 	ln -f $(DESTDIR)$(service_path)/lmtpd $(DESTDIR)$(service_path)/lmtpproxyd
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
 ### libimap
 
-libimap.a: $(LOBJS)
-	rm -f libimap.a
-	ar cr libimap.a $(LOBJS)
-	$(RANLIB) libimap.a
+libimap.la: $(LOBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libimap.la $(LOBJS)
 
 ### Built Source Files
 
 xversion xversion.h:
 	AWK=$(AWK) $(srcdir)/xversion.sh
 
-version.o: xversion.h
+version.lo: xversion.h
 
 pushstats.c: pushstats.snmp $(srcdir)/../snmp/snmpgen
 	$(srcdir)/../snmp/snmpgen $(srcdir)/pushstats.snmp
@@ -183,179 +183,179 @@
 mupdate_err.h: mupdate_err.c
 
 ### Services
-idled: idled.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o idled \
-	 idled.o mutex_fake.o libimap.a $(DEPLIBS) $(LIBS)
-
-lmtpd: lmtpd.o proxy.o $(LMTPOBJS) $(SIEVE_OBJS) mutex_fake.o \
-	 libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o lmtpd \
-	 $(SERVICE) lmtpd.o proxy.o $(LMTPOBJS) $(SIEVE_OBJS) \
-	 mutex_fake.o libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
-
-lmtpd.pure: lmtpd.o proxy.o $(LMTPOBJS) $(SIEVE_OBJS) \
-	 mutex_fake.o libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o lmtpd.pure \
-	 $(SERVICE) lmtpd.o proxy.o $(LMTPOBJS) $(SIEVE_OBJS) \
-	 mutex_fake.o libimap.a $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
-
-imapd: $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o imapd \
-	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o \
-	libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
-
-imapd.pure: $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o imapd.pure \
-	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o libimap.a \
+idled: idled.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o idled \
+	 idled.lo mutex_fake.lo libimap.la $(DEPLIBS) $(LIBS)
+
+lmtpd: lmtpd.lo proxy.lo $(LMTPOBJS) $(SIEVE_OBJS) mutex_fake.lo \
+	 libimap.la $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
+	 $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o lmtpd \
+	 $(SERVICE) lmtpd.lo proxy.lo $(LMTPOBJS) $(SIEVE_OBJS) \
+	 mutex_fake.lo libimap.la $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
+
+lmtpd.pure: lmtpd.lo proxy.lo $(LMTPOBJS) $(SIEVE_OBJS) \
+	 mutex_fake.lo libimap.la $(SIEVE_LIBS) $(DEPLIBS) $(SERVICE)
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o lmtpd.pure \
+	 $(SERVICE) lmtpd.lo proxy.lo $(LMTPOBJS) $(SIEVE_OBJS) \
+	 mutex_fake.lo libimap.la $(SIEVE_LIBS) $(DEPLIBS) $(LIBS) $(LIB_WRAP)
+
+imapd: $(IMAPDOBJS) mutex_fake.lo libimap.la $(DEPLIBS) $(SERVICE)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o imapd \
+	 $(SERVICE) $(IMAPDOBJS) mutex_fake.lo \
+	libimap.la $(DEPLIBS) $(LIBS) $(LIB_WRAP)
+
+imapd.pure: $(IMAPDOBJS) mutex_fake.lo libimap.la $(DEPLIBS) $(SERVICE)
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o imapd.pure \
+	 $(SERVICE) $(IMAPDOBJS) mutex_fake.lo libimap.la \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-imapd.quant: $(IMAPDOBJS) mutex_fake.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(QUANTIFY) $(QUANTOPT) $(CC) $(LDFLAGS) -o imapd.quant \
-	 $(SERVICE) $(IMAPDOBJS) mutex_fake.o libimap.a \
+imapd.quant: $(IMAPDOBJS) mutex_fake.lo libimap.la $(DEPLIBS) $(SERVICE)
+	$(QUANTIFY) $(QUANTOPT) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o imapd.quant \
+	 $(SERVICE) $(IMAPDOBJS) mutex_fake.lo libimap.la \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-mupdate: mupdate.o mupdate-slave.o mupdate-client.o mutex_pthread.o tls.o \
-	libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o mupdate \
-	 $(SERVICETHREAD) mupdate.o mupdate-slave.o mupdate-client.o \
-	 mutex_pthread.o tls.o libimap.a \
+mupdate: mupdate.lo mupdate-slave.lo mupdate-client.lo mutex_pthread.lo tls.lo \
+	libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o mupdate \
+	 $(SERVICETHREAD) mupdate.lo mupdate-slave.lo mupdate-client.lo \
+	 mutex_pthread.lo tls.lo libimap.la \
 	 $(DEPLIBS) $(LIBS) $(LIB_WRAP) -lpthread
 
-mupdate.pure: mupdate.o mupdate-slave.o mupdate-client.o mutex_pthread.o \
-	libimap.a $(DEPLIBS)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o mupdate.pure \
-	 $(SERVICETHREAD) mupdate.o mupdate-slave.o mupdate-client.o \
-	 mutex_pthread.o libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP) -lpthread
+mupdate.pure: mupdate.lo mupdate-slave.lo mupdate-client.lo mutex_pthread.lo \
+	libimap.la $(DEPLIBS)
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o mupdate.pure \
+	 $(SERVICETHREAD) mupdate.lo mupdate-slave.lo mupdate-client.lo \
+	 mutex_pthread.lo libimap.la $(DEPLIBS) $(LIBS) $(LIB_WRAP) -lpthread
 
-pop3d: pop3d.o proxy.o backend.o tls.o mutex_fake.o libimap.a \
+pop3d: pop3d.lo proxy.lo backend.lo tls.lo mutex_fake.lo libimap.la \
 	$(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o pop3d pop3d.o proxy.o backend.o tls.o $(SERVICE) \
-	 mutex_fake.o libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o pop3d pop3d.lo proxy.lo backend.lo tls.lo $(SERVICE) \
+	 mutex_fake.lo libimap.la $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-nntpd: nntpd.o proxy.o backend.o index.o smtpclient.o spool.o tls.o \
-	 mutex_fake.o nntp_err.o libimap.a $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o nntpd nntpd.o proxy.o backend.o index.o spool.o \
-	 smtpclient.o tls.o $(SERVICE) mutex_fake.o nntp_err.o \
-	 libimap.a $(DEPLIBS) $(LIBS) $(LIB_WRAP)
+nntpd: nntpd.lo proxy.lo backend.lo index.lo smtpclient.lo spool.lo tls.lo \
+	 mutex_fake.lo nntp_err.lo libimap.la $(DEPLIBS) $(SERVICE)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o nntpd nntpd.lo proxy.lo backend.lo index.lo spool.lo \
+	 smtpclient.lo tls.lo $(SERVICE) mutex_fake.lo nntp_err.lo \
+	 libimap.la $(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-fud: fud.o libimap.a mutex_fake.o $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o fud $(SERVICE) fud.o mutex_fake.o libimap.a \
+fud: fud.lo libimap.la mutex_fake.lo $(DEPLIBS) $(SERVICE)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o fud $(SERVICE) fud.lo mutex_fake.lo libimap.la \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-smmapd: smmapd.o libimap.a mutex_fake.o $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o smmapd $(SERVICE) smmapd.o mutex_fake.o libimap.a \
+smmapd: smmapd.lo libimap.la mutex_fake.lo $(DEPLIBS) $(SERVICE)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o smmapd $(SERVICE) smmapd.lo mutex_fake.lo libimap.la \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
-sync_server: sync_server.o sync_support.o sync_commit.o \
-	imapparse.o tls.o libimap.a mutex_fake.o $(DEPLIBS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o \
-	sync_server sync_server.o sync_support.o sync_commit.o \
-	imapparse.o tls.o $(SERVICE) libimap.a mutex_fake.o \
+sync_server: sync_server.lo sync_support.lo sync_commit.lo \
+	imapparse.lo tls.lo libimap.la mutex_fake.lo $(DEPLIBS) $(SERVICE)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	sync_server sync_server.lo sync_support.lo sync_commit.lo \
+	imapparse.lo tls.lo $(SERVICE) libimap.la mutex_fake.lo \
 	$(DEPLIBS) $(LIBS) $(LIB_WRAP)
 
 ### Command Line Utilities
-arbitron: arbitron.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o arbitron arbitron.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-cyr_dbtool: cyr_dbtool.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cyr_dbtool cyr_dbtool.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-cyr_synclog: cyr_synclog.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cyr_synclog cyr_synclog.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-cvt_cyrusdb: cvt_cyrusdb.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cvt_cyrusdb cvt_cyrusdb.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-chk_cyrus: chk_cyrus.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o chk_cyrus chk_cyrus.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-deliver: deliver.o $(LMTPOBJS) proxy.o mutex_fake.o libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o deliver deliver.o $(LMTPOBJS) proxy.o \
-	mutex_fake.o libimap.a $(DEPLIBS) $(LIBS)
-
-ctl_deliver: ctl_deliver.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 $@ ctl_deliver.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-ctl_mboxlist: ctl_mboxlist.o mupdate-client.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ ctl_mboxlist.o mupdate-client.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-ctl_cyrusdb: ctl_cyrusdb.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 $@ ctl_cyrusdb.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-cyr_expire: cyr_expire.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ cyr_expire.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-fetchnews: fetchnews.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 $@ fetchnews.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-squatter: squatter.o index.o squat_build.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o squatter squatter.o index.o squat_build.o \
-	$(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
+arbitron: arbitron.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o arbitron arbitron.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+cyr_dbtool: cyr_dbtool.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o cyr_dbtool cyr_dbtool.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+cyr_synclog: cyr_synclog.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o cyr_synclog cyr_synclog.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+cvt_cyrusdb: cvt_cyrusdb.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o cvt_cyrusdb cvt_cyrusdb.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+chk_cyrus: chk_cyrus.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o chk_cyrus chk_cyrus.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+deliver: deliver.lo $(LMTPOBJS) proxy.lo mutex_fake.lo libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o deliver deliver.lo $(LMTPOBJS) proxy.lo \
+	mutex_fake.lo libimap.la $(DEPLIBS) $(LIBS)
+
+ctl_deliver: ctl_deliver.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 $@ ctl_deliver.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+ctl_mboxlist: ctl_mboxlist.lo mupdate-client.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ctl_mboxlist.lo mupdate-client.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+ctl_cyrusdb: ctl_cyrusdb.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 $@ ctl_cyrusdb.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+cyr_expire: cyr_expire.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ cyr_expire.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+fetchnews: fetchnews.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 $@ fetchnews.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+squatter: squatter.lo index.lo squat_build.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o squatter squatter.lo index.lo squat_build.lo \
+	$(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
 
-mbpath: mbpath.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o mbpath mbpath.o $(CLIOBJS) libimap.a \
+mbpath: mbpath.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o mbpath mbpath.lo $(CLIOBJS) libimap.la \
 	$(DEPLIBS) $(LIBS)
 
-ipurge: ipurge.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o ipurge ipurge.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-cyrdump: cyrdump.o index.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o cyrdump cyrdump.o index.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-mbexamine: mbexamine.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 mbexamine mbexamine.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-reconstruct: reconstruct.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 reconstruct reconstruct.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-quota: quota.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o quota quota.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-tls_prune: tls_prune.o tls.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	 $@ tls_prune.o tls.o $(CLIOBJS) libimap.a $(DEPLIBS) $(LIBS)
-
-unexpunge: unexpunge.o $(CLIOBJS) libimap.a $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ unexpunge.o $(CLIOBJS) \
-	libimap.a $(DEPLIBS) $(LIBS)
-
-make_md5: make_md5.o libimap.a mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o make_md5 make_md5.o libimap.a mutex_fake.o $(DEPLIBS) $(LIBS)
-
-make_sha1: make_sha1.o libimap.a mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o make_sha1 make_sha1.o libimap.a mutex_fake.o $(DEPLIBS) $(LIBS)
-
-sync_client: sync_client.o sync_support.o \
-	backend.o tls.o imapparse.o libimap.a mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	sync_client sync_client.o sync_support.o \
-	backend.o tls.o imapparse.o libimap.a mutex_fake.o $(DEPLIBS) $(LIBS)
-
-sync_reset: sync_reset.o sync_support.o sync_commit.o \
-	libimap.a mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o \
-	sync_reset sync_reset.o sync_support.o sync_commit.o \
-	libimap.a mutex_fake.o $(DEPLIBS) $(LIBS)
+ipurge: ipurge.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o ipurge ipurge.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+cyrdump: cyrdump.lo index.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o cyrdump cyrdump.lo index.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+mbexamine: mbexamine.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 mbexamine mbexamine.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+reconstruct: reconstruct.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 reconstruct reconstruct.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+quota: quota.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o quota quota.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+tls_prune: tls_prune.lo tls.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	 $@ tls_prune.lo tls.lo $(CLIOBJS) libimap.la $(DEPLIBS) $(LIBS)
+
+unexpunge: unexpunge.lo $(CLIOBJS) libimap.la $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ unexpunge.lo $(CLIOBJS) \
+	libimap.la $(DEPLIBS) $(LIBS)
+
+make_md5: make_md5.lo libimap.la mutex_fake.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o make_md5 make_md5.lo libimap.la mutex_fake.lo $(DEPLIBS) $(LIBS)
+
+make_sha1: make_sha1.lo libimap.la mutex_fake.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o make_sha1 make_sha1.lo libimap.la mutex_fake.lo $(DEPLIBS) $(LIBS)
+
+sync_client: sync_client.lo sync_support.lo \
+	backend.lo tls.lo imapparse.lo libimap.la mutex_fake.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	sync_client sync_client.lo sync_support.lo \
+	backend.lo tls.lo imapparse.lo libimap.la mutex_fake.lo $(DEPLIBS) $(LIBS)
+
+sync_reset: sync_reset.lo sync_support.lo sync_commit.lo \
+	libimap.la mutex_fake.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o \
+	sync_reset sync_reset.lo sync_support.lo sync_commit.lo \
+	libimap.la mutex_fake.lo $(DEPLIBS) $(LIBS)
 
 ### Other Misc Targets
 
 clean:
-	rm -f *.o *.a Makefile.bak makedepend.log \
+	rm -rf .libs *.o *.lo *.a *.la Makefile.bak makedepend.log \
 	$(BUILTSOURCES) $(PROGS) $(SUIDPROGS)
 
 distclean: clean
--- cyrus-imapd-2.3.12p2.shared/imtest/Makefile.in	2008-09-23 21:44:50.599845178 +0300
+++ cyrus-imapd-2.3.12p2/imtest/Makefile.in	2008-09-23 22:10:57.494451435 +0300
@@ -50,12 +50,14 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@
 CPPFLAGS = -I.. -I$(srcdir)/../lib @COM_ERR_CPPFLAGS@ @CPPFLAGS@  @SASLFLAGS@
 LIBS = @LIBS@ 
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@ @COM_ERR_LDFLAGS@
@@ -73,7 +75,7 @@
 all: imtest
 
 install:
-	$(INSTALL) -s -m 755 imtest $(DESTDIR)$(exec_prefix)/bin
+	$(LIBTOOL) --mode=install $(INSTALL) imtest $(DESTDIR)$(exec_prefix)/bin
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/pop3test
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/nntptest
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/lmtptest
@@ -82,17 +84,17 @@
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/sivtest
 	ln -f $(DESTDIR)$(exec_prefix)/bin/imtest $(DESTDIR)$(exec_prefix)/bin/synctest
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
-imtest: imtest.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o imtest imtest.o $(DEPLIBS) $(IMAP_LIBS)
+imtest: imtest.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o imtest imtest.lo $(DEPLIBS) $(IMAP_LIBS)
 
-imtest.pure: imtest.o $(DEPLIBS)
-	$(PURIFY) $(PUREOPT) $(CC) $(LDFLAGS) -o imtest $(OBJS) $(DEPLIBS) $(LIBS) $(IMAP_LIBS)
+imtest.pure: imtest.lo $(DEPLIBS)
+	$(PURIFY) $(PUREOPT) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o imtest $(OBJS) $(DEPLIBS) $(LIBS) $(IMAP_LIBS)
 
 clean:
-	rm -f *.o Makefile.bak makedepend.log imtest
+	rm -rf .libs *.o *.lo Makefile.bak makedepend.log imtest
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/imtest/imtest.c	2008-04-11 15:35:18.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/imtest/imtest.c	2008-09-23 21:44:50.595844947 +0300
@@ -272,6 +272,9 @@
     imtest_fatal(msg);
 }
 
+/* config.c stuff */
+const int config_need_data = 0;
+
 int mysasl_config(void *context __attribute__((unused)), 
 		  const char *plugin_name,
 		  const char *option,
--- cyrus-imapd-2.3.12p2/installsieve/Makefile.in	2008-03-24 22:33:11.000000000 +0200
+++ cyrus-imapd-2.3.12p2.shared/installsieve/Makefile.in	2008-09-23 21:44:50.591844716 +0300
@@ -47,6 +47,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir) -I$(srcdir)/../lib @CPPFLAGS@ @SASLFLAGS@
@@ -59,7 +61,7 @@
 
 IMAP_LIBS = @IMAP_LIBS@
 LIBS = 
-DEPLIBS= ../lib/libcyrus.a @DEPLIBS@
+DEPLIBS= ../lib/libcyrus.la @DEPLIBS@
 
 prefix = @prefix@
 exec_prefix = @exec_prefix@
@@ -68,20 +70,18 @@
 all: installsieve
 
 install:
-	$(INSTALL) -s -m 755 installsieve $(DESTDIR)$(exec_prefix)/bin
+	$(LIBTOOL) --mode=install $(INSTALL) installsieve $(DESTDIR)$(exec_prefix)/bin
 
-OBJS=lex.o mystring.o request.o isieve.o
+OBJS=lex.lo mystring.lo request.lo isieve.lo
 
-libinstallsieve.a: $(OBJS)
-	rm -f libinstallsieve.a
-	ar cr libinstallsieve.a $(OBJS)
-	$(RANLIB) libinstallsieve.a
+libinstallsieve.la: $(OBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libinstallsieve.la $(OBJS)
 
-installsieve: libinstallsieve.a installscript.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o installsieve libinstallsieve.a installscript.o $(DEPLIBS) $(IMAP_LIBS)
+installsieve: libinstallsieve.la installscript.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o installsieve libinstallsieve.la installscript.lo $(DEPLIBS) $(IMAP_LIBS)
 
 clean:
-	rm -f *.o *.a Makefile.bak makedepend.log
+	rm -rf .libs *.o *.lo *.a *.la Makefile.bak makedepend.log
 
 distclean: clean
 	rm -f Makefile installsieve
@@ -89,9 +89,8 @@
 depend:
 	${MAKEDEPEND} $(CPPFLAGS) $(DEFS) -I$(srcdir) $(CFLAGS) *.c $(srcdir)/*.c 1>makedepend.log 2>&1
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I. $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I. $(CFLAGS) \
 	$<
 
-
 # DO NOT DELETE THIS LINE -- make depend depends on it.
--- cyrus-imapd-2.3.12p2.shared/lib/Makefile.in	2008-09-23 21:44:50.599845178 +0300
+++ cyrus-imapd-2.3.12p2/lib/Makefile.in	2008-09-23 21:52:42.531135729 +0300
@@ -44,10 +44,10 @@
 # $Id$
 
 # Authorization namespace.
-AUTH=auth.o auth_krb.o auth_unix.o auth_krb5.o auth_pts.o
+AUTH=auth.lo auth_krb.lo auth_unix.lo auth_krb5.lo auth_pts.lo
 
 # ACL interpretation.  Only one choice for now:
-ACL=acl_afs.o
+ACL=acl_afs.lo
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
@@ -57,6 +57,8 @@
 
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@
 CPPFLAGS = -I.. @CPPFLAGS@ @COM_ERR_CPPFLAGS@ @SASLFLAGS@
@@ -72,6 +74,7 @@
 prefix = @prefix@
 exec_prefix = @exec_prefix@
 cyrus_prefix = @cyrus_prefix@
+libdir = @libdir@
 
 libdir = @libdir@
 
@@ -90,29 +93,28 @@
 	$(srcdir)/libcyr_cfg.h $(srcdir)/byteorder64.h \
 	$(srcdir)/md5.h $(srcdir)/hmac-md5.h
 
-LIBCYR_OBJS = acl.o bsearch.o charset.o glob.o retry.o util.o \
-	libcyr_cfg.o mkgmtime.o prot.o parseaddr.o imclient.o imparse.o \
-	lsort.o stristr.o rfc822date.o cyrusdb.o strhash.o \
-	chartable.o imapurl.o nonblock_@WITH_NONBLOCK@.o lock_@WITH_LOCK@.o \
-	gmtoff_@WITH_GMTOFF@.o map_@WITH_MAP@.o $(ACL) $(AUTH) \
+LIBCYR_OBJS = acl.lo bsearch.lo charset.lo glob.lo retry.lo util.lo \
+	libcyr_cfg.lo mkgmtime.lo prot.lo parseaddr.lo imclient.lo imparse.lo \
+	lsort.lo stristr.lo rfc822date.lo cyrusdb.lo strhash.lo \
+	chartable.lo imapurl.lo nonblock_@WITH_NONBLOCK@.lo lock_@WITH_LOCK@.lo \
+	gmtoff_@WITH_GMTOFF@.lo map_@WITH_MAP@.lo $(ACL) $(AUTH) \
 	@LIBOBJS@ @CYRUSDB_OBJS@ @MD5OBJ@ \
-	iptostring.o xmalloc.o wildmat.o byteorder64.o \
-	xstrlcat.o xstrlcpy.o
+	iptostring.lo xmalloc.lo wildmat.lo byteorder64.lo \
+	xstrlcat.lo xstrlcpy.lo
 
 LIBCYRM_HDRS = $(srcdir)/hash.h $(srcdir)/mpool.h $(srcdir)/xmalloc.h \
 	$(srcdir)/xstrlcat.h $(srcdir)/xstrlcpy.h $(srcdir)/util.h \
 	$(srcdir)/strhash.h $(srcdir)/libconfig.h $(srcdir)/assert.h \
 	imapopts.h
-LIBCYRM_OBJS = libconfig.o imapopts.o hash.o mpool.o xmalloc.o strhash.o \
-	xstrlcat.o xstrlcpy.o assert.o util.o @IPV6_OBJS@
+LIBCYRM_OBJS = libconfig.lo imapopts.lo hash.lo mpool.lo xmalloc.lo strhash.lo \
+	xstrlcat.lo xstrlcpy.lo assert.lo util.lo @IPV6_OBJS@
 
-all: $(BUILTSOURCES) libcyrus_min.a libcyrus.a
+all: $(BUILTSOURCES) libcyrus_min.la libcyrus.la
 
 install:
 	$(srcdir)/../install-sh -d $(DESTDIR)$(libdir)
-	$(INSTALL) -m 644 libcyrus.a $(DESTDIR)$(libdir)
-	$(INSTALL) -m 644 libcyrus_min.a $(DESTDIR)$(libdir)
-	 $(RANLIB) $(DESTDIR)$(libdir)/libcyrus.a
+	$(LIBTOOL) --mode=install $(INSTALL) -m 644 libcyrus.la $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install $(INSTALL) -m 644 libcyrus_min.la $(DESTDIR)$(libdir)
 	for file in $(LIBCYR_HDRS); \
 	do \
 		$(INSTALL) -m 644 $$file $(DESTDIR)$(prefix)/include/cyrus || exit 1; \
@@ -122,19 +124,15 @@
 		$(INSTALL) -m 644 $$file $(DESTDIR)$(prefix)/include/cyrus || exit 1; \
 	done
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
-libcyrus.a: $(LIBCYR_OBJS)
-	rm -f libcyrus.a
-	ar cr libcyrus.a $(LIBCYR_OBJS)
-	$(RANLIB) libcyrus.a
-
-libcyrus_min.a: $(LIBCYRM_OBJS)
-	rm -f libcyrus_min.a
-	ar cr libcyrus_min.a $(LIBCYRM_OBJS)
-	$(RANLIB) libcyrus_min.a
+libcyrus.la: $(LIBCYR_OBJS) libcyrus_min.la
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libcyrus.la $(LIBCYR_OBJS) libcyrus_min.la @LIBS@ @LIB_SASL@ -rpath $(libdir)
+
+libcyrus_min.la: $(LIBCYRM_OBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libcyrus_min.la $(LIBCYRM_OBJS) @IMAP_COM_ERR_LIBS@ -rpath $(libdir)
 
 imapopts.c: imapoptions $(srcdir)/../tools/config2header
 	$(srcdir)/../tools/config2header CC="$(CC)" $(srcdir)/imapopts.c $(srcdir)/imapopts.h < $(srcdir)/imapoptions
@@ -154,11 +152,11 @@
 #	./mkchartable -m $(srcdir)/charset/unicode.map $(srcdir)/charset/*.t >x-chartables.h
 #	mv x-chartables.h chartables.h
 
-mkchartable: mkchartable.o xstrlcpy.o xstrlcat.o xmalloc.o assert.o
-	$(CC) $(LDFLAGS) -o mkchartable mkchartable.o xstrlcpy.o xstrlcat.o xmalloc.o assert.o
+mkchartable: mkchartable.lo xstrlcpy.lo xstrlcat.lo xmalloc.lo assert.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o mkchartable mkchartable.lo xstrlcpy.lo xstrlcat.lo xmalloc.lo assert.lo
 
 clean:
-	rm -f *.o *.a chartable.c Makefile.bak mkchartable makedepend.log \
+	rm -rf .libs *.o *.lo *.a *.la chartable.c Makefile.bak mkchartable makedepend.log \
 	$(BUILTSOURCES)
 
 distclean: clean
--- cyrus-imapd-2.3.12p2.shared/master/Makefile.in	2008-09-23 21:44:50.599845178 +0300
+++ cyrus-imapd-2.3.12p2/master/Makefile.in	2008-09-23 22:12:15.234944271 +0300
@@ -48,6 +48,8 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 CYRUS_USER=@cyrus_user@
 CYRUS_GROUP=@cyrus_group@
@@ -58,7 +60,7 @@
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@ @COM_ERR_LDFLAGS@
-LIBS = ../lib/libcyrus_min.a @LIB_UCDSNMP@ @LIBS@ @COM_ERR_LIBS@
+LIBS = ../lib/libcyrus_min.la @LIB_UCDSNMP@ @LIBS@ @COM_ERR_LIBS@
 
 SHELL = /bin/sh
 MAKEDEPEND = @MAKEDEPEND@
@@ -68,7 +70,7 @@
 cyrus_prefix = @cyrus_prefix@
 service_path = @service_path@
 
-LOBJS=service.o service-thread.o
+LOBJS=service.lo service-thread.lo
 
 PROGS=master
 
@@ -78,18 +80,18 @@
 	$(srcdir)/../install-sh -d ${DESTDIR}$(service_path)
 	for file in $(PROGS); \
 	do \
-		$(INSTALL) -m 755 $$file $(DESTDIR)$(service_path) || exit 1; \
+		$(LIBTOOL) --mode=install $(INSTALL) $$file $(DESTDIR)$(service_path) || exit 1; \
 	done
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
-master: master.o masterconf.o cyrusMasterMIB.o ../lib/lock_@WITH_LOCK@.o
-	$(CC) $(LDFLAGS) -o master master.o masterconf.o cyrusMasterMIB.o ../lib/lock_@WITH_LOCK@.o $(LIBS) $(DEPLIBS)
+master: master.lo masterconf.lo cyrusMasterMIB.lo ../lib/lock_@WITH_LOCK@.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o master master.lo masterconf.lo cyrusMasterMIB.lo ../lib/lock_@WITH_LOCK@.lo $(LIBS) $(DEPLIBS)
 
 clean:
-	rm -f *.o *.a Makefile.bak $(PROGS)
+	rm -rf .libs *.lo *.a *.la Makefile.bak $(PROGS)
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2.shared/netnews/Makefile.in	2008-09-23 21:44:50.587844484 +0300
+++ cyrus-imapd-2.3.12p2/netnews/Makefile.in	2008-09-23 22:09:19.744800216 +0300
@@ -49,11 +49,13 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I.. -I$(srcdir) -I$(srcdir)/../lib -I$(srcdir)/../com_err/et @CPPFLAGS@
 LIBS =  @IMAP_LIBS@ @LIB_RT@
-DEPLIBS = ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@ 
+DEPLIBS = ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@ 
 
 CFLAGS = @CFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -66,23 +68,23 @@
 cyrus_prefix = @cyrus_prefix@
 service_path = @service_path@
 
-OBJS = remotepurge.o readconfig.o
+OBJS = remotepurge.lo readconfig.lo
 
 all: remotepurge
 
 install:
-	$(INSTALL) -s -m 755 remotepurge $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) remotepurge $(DESTDIR)$(service_path)
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
 remotepurge: $(OBJS) $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o remotepurge $(OBJS) \
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o remotepurge $(OBJS) \
 		$(DEPLIBS) $(LIBS)
 
 
 clean:
-	rm -f *.o Makefile.bak remotepurge makedepend.log
+	rm -rf .libs *.o *.lo Makefile.bak remotepurge makedepend.log
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/notifyd/Makefile.in	2008-09-23 21:50:36.163828302 +0300
+++ cyrus-imapd-2.3.12p2/notifyd/Makefile.in	2008-09-23 22:45:04.180745070 +0300
@@ -49,6 +49,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 INSTALL = @INSTALL@
 CYRUS_USER=@cyrus_user@
@@ -68,13 +70,13 @@
 
 NOTIFYD_LIBS = @NOTIFYD_LIBS@
 
-SERVICE=../master/service.o
+SERVICE=../master/service.lo
 
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = @ZEPHYR_LIBS@ @LIBS@ $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS=../imap/mutex_fake.lo ../imap/libimap.la ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 PURIFY=/usr/local/bin/purify
 PUREOPT=-best-effort
@@ -84,23 +86,23 @@
 install:
 	$(INSTALL) -m 755 notifyd $(DESTDIR)$(service_path)
 
-OBJS= notifyd.o notify_null.o notify_log.o notify_mailto.o notify_zephyr.o
+OBJS= notifyd.lo notify_null.lo notify_log.lo notify_mailto.lo notify_zephyr.lo
 
-notifytest: notifytest.o
-	$(CC) $(LDFLAGS) -o notifytest \
-	 notifytest.o $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
+notifytest: notifytest.lo
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) $(LDFLAGS) -o notifytest \
+	 notifytest.lo $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 notifyd: $(OBJS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o notifyd \
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) $(LDFLAGS) -o notifyd \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 notifyd.pure: $(OBJS) $(SERVICE)
 	$(PURIFY) $(PUREOPT) \
-	$(CC) $(LDFLAGS) -o notifyd.pure \
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) $(LDFLAGS) -o notifyd.pure \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 clean:
-	rm -f notifyd notifytest *.o *.a *~ Makefile.bak makedepend.log
+	rm -rf notifyd notifytest .libs *.o *.lo *.a *.la *~ Makefile.bak makedepend.log
 
 distclean: clean
 	rm -f Makefile
@@ -108,8 +110,8 @@
 depend:
 	${MAKEDEPEND} $(CPPFLAGS) $(DEFS) -I$(srcdir) $(CFLAGS) *.c $(srcdir)/*.c 1>makedepend.log 2>&1
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
 # DO NOT DELETE THIS LINE -- make depend depends on it.
--- cyrus-imapd-2.3.12p2/perl/imap/IMAP.xs	2008-04-04 15:47:09.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/perl/imap/IMAP.xs	2008-09-23 21:44:50.595844947 +0300
@@ -76,6 +76,7 @@
 {
   croak(s);
 }
+const int config_need_data = 0;
 
 /*
  * Decrement the refcounts of the Perl SV's in the passed rock, then free the
--- cyrus-imapd-2.3.12p2/perl/imap/Makefile.PL	2007-10-17 23:06:33.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/perl/imap/Makefile.PL	2008-09-23 21:44:50.595844947 +0300
@@ -63,8 +63,7 @@
     'macro'	=> {'IMCLIENT_LIBS' => ''},	# hack
     'clean'	=> {'FILES' => 'libcyrperl.a cyradm'},
     'OBJECT'    => 'IMAP.o',
-    'MYEXTLIB'  => '../../lib/libcyrus.a ../../lib/libcyrus_min.a',
-    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto"],
+    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto -L../../lib/.libs -lcyrus -lcyrus_min"],
     'DEFINE'	=> '-DPERL_POLLUTE',    # e.g., '-DHAVE_SOMETHING' 
     'INC'	=> "-I../../lib -I../.. -I../../com_err/et $SASL_INC $OPENSSL_INC", 
     'EXE_FILES' => [cyradm],
--- cyrus-imapd-2.3.12p2.shared/perl/sieve/lib/Makefile.in	2008-09-23 21:44:50.595844947 +0300
+++ cyrus-imapd-2.3.12p2/perl/sieve/lib/Makefile.in	2008-09-23 22:08:41.078564354 +0300
@@ -50,12 +50,14 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@ @LOCALDEFS@ -Dbool=char -DHAS_BOOL
 CPPFLAGS = -I. -I../../.. -I$(srcdir) -I$(srcdir)/../../../lib @CPPFLAGS@ @DYNSASLFLAGS@ @COM_ERR_CPPFLAGS@
-LIBS = ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a @LIB_DYN_SASL@ @LIBS@
+LIBS = ../../../lib/libcyrus.la ../../../lib/libcyrus_min.la @LIB_DYN_SASL@ @LIBS@
 IMAP_LIBS = @IMAP_LIBS@
-DEPLIBS = ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS = ../../../lib/libcyrus.la ../../../lib/libcyrus_min.la @DEPLIBS@
 
 MAKEDEPEND_CFLAGS = @CFLAGS@
 CFLAGS = @CFLAGS@ @PERL_CCCDLFLAGS@
@@ -68,22 +70,20 @@
 exec_prefix = @exec_prefix@
 cyrus_prefix = @cyrus_prefix@
 
-OBJS=isieve.o lex.o mystring.o request.o
+OBJS=isieve.lo lex.lo mystring.lo request.lo
 
-all: libisieve.a
+all: libisieve.la
 
 install:
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
-libisieve.a: $(OBJS)
-	rm -f libisieve.a
-	ar cr libisieve.a $(OBJS)
-	$(RANLIB) libisieve.a
+libisieve.la: $(OBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libisievie.la $(OBJS)
 
 clean:
-	rm -f *.o Makefile.bak makedepend.log libisieve.a
+	rm -rf .libs *.o *.lo Makefile.bak makedepend.log libisieve.la
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/perl/sieve/managesieve/Makefile.PL	2008-04-04 15:47:23.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/perl/sieve/managesieve/Makefile.PL	2008-09-23 21:44:50.591844716 +0300
@@ -60,8 +60,8 @@
     'NAME'	=> 'Cyrus::SIEVE::managesieve',
     'ABSTRACT'  => 'Cyurs Sieve management interface',
     'VERSION_FROM' => 'managesieve.pm', # finds $VERSION
-    'MYEXTLIB'  => '../lib/isieve.o ../lib/lex.o ../lib/mystring.o ../lib/request.o ../../../lib/libcyrus.a ../../../lib/libcyrus_min.a',
-    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto"], 
+    'MYEXTLIB'  => '../lib/.libs/isieve.o ../lib/.libs/lex.o ../lib/.libs/mystring.o ../lib/.libs/request.o',
+    'LIBS'	=> ["$BDB_LIB $SASL_LIB $OPENSSL_LIB $LIB_RT -lssl -lcrypto -L../../../lib/.libs -lcyrus -lcyrus_min"], 
     'DEFINE'	=> '-DPERL_POLLUTE',     # e.g., '-DHAVE_SOMETHING' 
     'INC'	=> "-I../lib/ -I../../../lib/ $SASL_INC $OPENSSL_INC",
 );
--- cyrus-imapd-2.3.12p2/perl/sieve/managesieve/managesieve.xs	2008-04-04 15:47:24.000000000 +0300
+++ cyrus-imapd-2.3.12p2.shared/perl/sieve/managesieve/managesieve.xs	2008-09-23 21:44:50.595844947 +0300
@@ -72,6 +72,7 @@
     croak("failure: %s", s);
     exit(-1);
 }
+const int config_need_data = 0;
 
 static int
 perlsieve_getpass(conn, context, id, psecret)
--- cyrus-imapd-2.3.12p2/ptclient/Makefile.in	2008-03-24 20:34:22.000000000 +0200
+++ cyrus-imapd-2.3.12p2.shared/ptclient/Makefile.in	2008-09-23 21:44:50.587844484 +0300
@@ -51,6 +51,8 @@
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 DEFS = @DEFS@
 CPPFLAGS = -I.. -I$(srcdir)/../imap -I$(srcdir)/../lib @COM_ERR_CPPFLAGS@ @CPPFLAGS@ @SASLFLAGS@
@@ -60,8 +62,8 @@
 LIBS = $(IMAP_LIBS) @COM_ERR_LIBS@
 LIB_SASL = @LIB_SASL@
 LIB_WRAP = @LIB_WRAP@
-DEPLIBS = ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
-UTIL_LIBS = ../imap/mutex_fake.o ../imap/cli_fatal.o
+DEPLIBS = ../imap/libimap.la ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
+UTIL_LIBS = ../imap/mutex_fake.lo ../imap/cli_fatal.lo
 
 LDAP_LIBS=@LDAP_LIBS@
 LDAP_CPPFLAGS=@LDAP_CPPFLAGS@
@@ -83,42 +85,42 @@
 
 LIB_RT = @LIB_RT@
 
-SERVICE=../master/service.o
-SERVICETHREAD=../master/service-thread.o
+SERVICE=../master/service.lo
+SERVICETHREAD=../master/service-thread.lo
 
 all: $(PROGS)
 
 install:
-	$(INSTALL) -m 755 ptloader $(DESTDIR)$(service_path)
-	$(INSTALL) -m 755 ptexpire $(DESTDIR)$(service_path)
-	$(INSTALL) -m 755 ptdump $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptloader $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptexpire $(DESTDIR)$(service_path)
+	$(LIBTOOL) --mode=install $(INSTALL) ptdump $(DESTDIR)$(service_path)
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(LDAP_CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(LDAP_CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
-ptloader: ptloader.o afskrb.o ldap.o ../imap/mutex_fake.o $(DEPLIBS)
-	$(CC) $(LDFLAGS) -o $@ ptloader.o afskrb.o ldap.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+ptloader: ptloader.lo afskrb.lo ldap.lo ../imap/mutex_fake.lo $(DEPLIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptloader.lo afskrb.lo ldap.lo ../imap/mutex_fake.lo $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
-ptloader.pure: ptloader.o afskrb.o ldap.o ../imap/mutex_fake.o $(DEPLIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptloader.o afskrb.o ldap.o ../imap/mutex_fake.o $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+ptloader.pure: ptloader.lo afskrb.lo ldap.lo ../imap/mutex_fake.lo $(DEPLIBS)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptloader.lo afskrb.lo ldap.lo ../imap/mutex_fake.lo $(SERVICETHREAD) ${AFS_LDFLAGS} ${LDAP_LDFLAGS} $(AFS_LIBS) ${LDAP_LIBS} $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
-ptexpire: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_RT)
+ptexpire: ptexpire.lo $(DEPLIBS) $(UTIL_LIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptexpire.lo $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_RT)
 
-ptexpire.pure: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptexpire.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+ptexpire.pure: ptexpire.lo $(DEPLIBS) $(UTIL_LIBS)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptexpire.lo $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
-ptdump: ptdump.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_RT)
+ptdump: ptdump.lo $(DEPLIBS) $(UTIL_LIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptdump.lo $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_RT)
 
-ptdump.pure: ptexpire.o $(DEPLIBS) $(UTIL_LIBS)
-	$(PURIFY) $(PUREARGS) $(CC) $(LDFLAGS) -o $@ ptdump.o $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
+ptdump.pure: ptexpire.lo $(DEPLIBS) $(UTIL_LIBS)
+	$(PURIFY) $(PUREARGS) $(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptdump.lo $(UTIL_LIBS) $(DEPLIBS) $(LIB_SASL) $(LIBS) $(LIB_WRAP) $(LIB_RT)
 
-ptextract: ptextract.o $(DEPLIBS) $(UTIL_LIBS)
-	$(CC) $(LDFLAGS) -o $@ ptextract.o $(UTIL_LIBS) $(DEPLIBS) $(LIBS)
+ptextract: ptextract.lo $(DEPLIBS) $(UTIL_LIBS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o $@ ptextract.lo $(UTIL_LIBS) $(DEPLIBS) $(LIBS)
 
 clean:
-	rm -f *.o Makefile.bak $(PROGS) makedepend.log
+	rm -rf .libs *.o *.lo Makefile.bak $(PROGS) makedepend.log
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2.shared/sieve/Makefile.in	2008-09-23 21:44:50.587844484 +0300
+++ cyrus-imapd-2.3.12p2/sieve/Makefile.in	2008-09-23 21:57:13.302793477 +0300
@@ -55,6 +55,8 @@
 YFLAGS = -d
 LEX = @LEX@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 COMPILE_ET = @COMPILE_ET@
 
 DEFS = @DEFS@ @LOCALDEFS@
@@ -68,29 +70,29 @@
 IMAP_LIBS = @IMAP_LIBS@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
-LIBS = libsieve.a $(IMAP_LIBS) $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+LIBS = libsieve.la $(IMAP_LIBS) $(IMAP_COM_ERR_LIBS)
+DEPLIBS=../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 BUILT_SOURCES = addr.c addr.h addr-lex.c \
 	sieve.c sieve.h sieve-lex.c \
 	sieve_err.h sieve_err.c
 
-all: libsieve.a sievec sieved
+all: libsieve.la sievec sieved
 
 dist: $(BUILT_SOURCES)
 
 install: sievec
 	$(srcdir)/../install-sh -d ${DESTDIR}$(service_path)
-	$(srcdir)/../install-sh -c -m 755 sievec $(DESTDIR)$(service_path) || exit
+	$(LIBTOOL) --mode=install $(srcdir)/../install-sh -c -m 755 sievec $(DESTDIR)$(service_path) || exit
 
-test: $(DEPLIBS) libsieve.a test.o ../imap/message.o
-	$(CC) $(LDFLAGS) -o test test.o ../imap/message.o \
-	libsieve.a $(DEPLIBS) $(LIBS)
-
-OBJS = sieve_err.o \
-       sieve.o sieve-lex.o comparator.o interp.o message.o \
-       bc_generate.o bc_dump.o bc_emit.o bc_eval.o \
-       script.o tree.o addr.o addr-lex.o
+test: $(DEPLIBS) libsieve.la test.lo ../imap/message.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o test test.lo ../imap/message.lo \
+	libsieve.la $(DEPLIBS) $(LIBS)
+
+OBJS = sieve_err.lo \
+       sieve.lo sieve-lex.lo comparator.lo interp.lo message.lo \
+       bc_generate.lo bc_dump.lo bc_emit.lo bc_eval.lo \
+       script.lo tree.lo addr.lo addr-lex.lo
 
 sieve-lex.c: sieve-lex.l sieve.h
 
@@ -112,21 +114,19 @@
 
 # This is needed because 'makedepend' leaves it out 
 #(this is not in newer version, is it still needed?)
-#addr.o: addr.h  
+#addr.lo: addr.h  
 
 
-#libsieve.a: sieve.c sieve.h sieve_err.h sieve_err.c $(OBJS)
+#libsieve.la: sieve.c sieve.h sieve_err.h sieve_err.c $(OBJS)
 #changed to...
-libsieve.a: $(OBJS)
-	rm -f libsieve.a
-	ar cr libsieve.a $(OBJS)
-	$(RANLIB) libsieve.a
+libsieve.la: $(OBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libsieve.la $(OBJS)
 
-sievec: sievec.o libsieve.a
-	$(CC) $(LDFLAGS) -o sievec sievec.o libsieve.a $(DEPLIBS) $(LIBS)
+sievec: sievec.lo libsieve.la
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o sievec sievec.lo libsieve.la $(DEPLIBS) $(LIBS)
 
-sieved: sieved.o libsieve.a
-	$(CC) $(LDFLAGS) -o sieved sieved.o libsieve.a $(DEPLIBS) $(LIBS)
+sieved: sieved.lo libsieve.la
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o sieved sieved.lo libsieve.la $(DEPLIBS) $(LIBS)
 
 
 sieve_interface.h: sieve_err.h
@@ -135,7 +135,7 @@
 	$(COMPILE_ET) $(srcdir)/sieve_err.et
 
 clean:
-	rm -f sievec sieved test *~ *.o *.a Makefile.bak makedepend.log
+	rm -rf sievec sieved test *~ .libs *.o *.lo *.a *.la Makefile.bak makedepend.log
 
 distclean: clean
 	rm -f sieve_err.c sieve_err.h
@@ -147,8 +147,8 @@
 depend:
 	${MAKEDEPEND} $(CPPFLAGS) $(DEFS) -I$(srcdir) $(MAKEDEPEND_CFLAGS) *.c *.y $(srcdir)/*.y $(srcdir)/*.c 1>makedepend.log 2>&1
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
 # DO NOT DELETE THIS LINE -- make depend depends on it.
--- cyrus-imapd-2.3.12p2/timsieved/Makefile.in	2008-09-23 21:51:30.334960853 +0300
+++ cyrus-imapd-2.3.12p2/timsieved/Makefile.in	2008-09-23 22:45:44.807093322 +0300
@@ -49,6 +49,8 @@
 
 CC = @CC@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
+top_builddir = @top_builddir@
 
 INSTALL = @INSTALL@
 CYRUS_USER=@cyrus_user@
@@ -68,13 +70,13 @@
 
 TIMSIEVED_LIBS = @TIMSIEVED_LIBS@
 
-SERVICE=../master/service.o
+SERVICE=../master/service.lo
 
 IMAP_LIBS = @IMAP_LIBS@ @LIB_RT@
 IMAP_COM_ERR_LIBS = @IMAP_COM_ERR_LIBS@
 LIB_WRAP = @LIB_WRAP@
 LIBS = $(IMAP_COM_ERR_LIBS)
-DEPLIBS=../sieve/libsieve.a ../imap/mutex_fake.o ../imap/libimap.a ../lib/libcyrus.a ../lib/libcyrus_min.a @DEPLIBS@
+DEPLIBS=../sieve/libsieve.la ../imap/mutex_fake.lo ../imap/libimap.la ../lib/libcyrus.la ../lib/libcyrus_min.la @DEPLIBS@
 
 PURIFY=/usr/local/bin/purify
 PUREOPT=-best-effort
@@ -84,20 +86,20 @@
 install:
 	$(INSTALL) -m 755 timsieved $(DESTDIR)$(service_path)
 
-OBJS= actions.o lex.o mystring.o scripttest.o timsieved.o parser.o \
-	../imap/proxy.o
+OBJS= actions.lo lex.lo mystring.lo scripttest.lo timsieved.lo parser.lo \
+	../imap/proxy.lo
 
 timsieved: $(OBJS) $(SERVICE)
-	$(CC) $(LDFLAGS) -o timsieved \
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) $(LDFLAGS) -o timsieved \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 timsieved.pure: $(OBJS) $(SERVICE)
 	$(PURIFY) $(PUREOPT) \
-	$(CC) $(LDFLAGS) -o timsieved.pure \
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) $(LDFLAGS) -o timsieved.pure \
 	 $(SERVICE) $(OBJS) $(DEPLIBS) $(IMAP_LIBS) $(LIBS) $(LIB_WRAP)
 
 clean:
-	rm -f timsieved *~ *.o *.a Makefile.bak makedepend.log
+	rm -rf timsieved *~ .libs *.o *.lo *.a *.la Makefile.bak makedepend.log
 
 distclean: clean
 	rm -f Makefile
@@ -105,8 +107,8 @@
 depend:
 	${MAKEDEPEND} $(CPPFLAGS) $(DEFS) -I$(srcdir) $(CFLAGS) *.c $(srcdir)/*.c 1>makedepend.log 2>&1
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) \
 	$<
 
 # DO NOT DELETE THIS LINE -- make depend depends on it.
--- cyrus-imapd-2.3.12p2/makedepend/Makefile.in	2008-09-23 21:53:54.051271496 +0300
+++ cyrus-imapd-2.3.12p2/makedepend/Makefile.in	2008-09-23 21:54:30.469377429 +0300
@@ -44,11 +44,13 @@
 # $Id$
 # 
 srcdir = @srcdir@
+top_builddir = @top_builddir@
 VPATH = @srcdir@
 
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
 
 DEFS = @DEFS@
 CPPFLAGS = -I. -I$(srcdir)  @CPPFLAGS@ 
@@ -62,15 +64,15 @@
 
 all: makedepend
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<
 
-makedepend: cppsetup.o ifparser.o include.o main.o parse.o pr.o
-	$(CC) $(LDFLAGS) -o makedepend cppsetup.o ifparser.o include.o \
-		main.o parse.o pr.o $(DEPLIBS) $(LIBS)
+makedepend: cppsetup.lo ifparser.lo include.lo main.lo parse.lo pr.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o makedepend cppsetup.lo ifparser.lo include.lo \
+		main.lo parse.lo pr.lo $(DEPLIBS) $(LIBS)
 
 clean:
-	rm -f *.o Makefile.bak makedepend
+	rm -rf .libs *.o *.lo Makefile.bak makedepend
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/com_err/et/Makefile.in~	2008-03-24 20:53:40.000000000 +0200
+++ cyrus-imapd-2.3.12p2/com_err/et/Makefile.in	2008-09-23 22:08:08.228664820 +0300
@@ -44,11 +44,13 @@
 # $Id$
 
 srcdir = @srcdir@
+top_builddir = @top_builddir@
 VPATH = @srcdir@
 
 CC = @CC@
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
 ARCHIVE = ar cr
 
 AWK = @AWK@
@@ -63,19 +65,19 @@
 
 SHELL = /bin/sh
 
-LIBOBJS= error_message.o et_name.o init_et.o com_err.o
+LIBOBJS= error_message.lo et_name.lo init_et.lo com_err.lo
 # for et_lex.lex.c include in error_table.y
 LOCALINCLUDE=-I. -I.. -I$(srcdir)
 
-all: compile_et libcom_err.a
+all: compile_et libcom_err.la
 
 install:
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I$(srcdir)/../../lib -I. -I../.. $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) -I$(srcdir)/../../lib -I. -I../.. $(CFLAGS) $<
 
 # solaris make loses on com_err.c but not on init_et.c, but this helps
-com_err.o: com_err.c
+com_err.lo: com_err.c
 
 #
 # real entries...
@@ -92,13 +94,13 @@
 	$(CP) $(srcdir)/et_h.awk et_h.awk
 
 clean:
-	rm -f compile_et compile_et.o error_table.o 
-	rm -f libcom_err.a
+	rm -f compile_et compile_et.o compile_et.lo error_table.o error_table.lo 
+	rm -rf .libs libcom_err.a libcom_err.la
 	rm -f $(LIBOBJS)
 
 distclean: clean
-	rm -f compile_et compile_et.o error_table.o 
-	rm -f libcom_err.a
+	rm -f compile_et compile_et.o compile_et.lo error_table.o error_table.lo 
+	rm -rf .libs libcom_err.a libcom_err.la
 	rm -f $(LIBOBJS)
 	rm Makefile
 
@@ -119,21 +121,15 @@
 
 ## install_library_target(com_err,$(LIBOBJS),$(LINTFILES),)
 
-libcom_err.a: $(LIBOBJS)
-	rm -f libcom_err.a
-	$(ARCHIVE) $@ $(LIBOBJS)
-	$(RANLIB) $@
+libcom_err.la: $(LIBOBJS)
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libcom_err.la $(LIBOBJS)
 
 #install::
-#	$(INSTALLLIB) libcom_err.a $(DESTDIR)$(LIBDIR)/libcom_err.a
-#	$(CHMOD) 644 $(DESTDIR)$(LIBDIR)/libcom_err.a
-#	$(RANLIB)    $(DESTDIR)$(LIBDIR)/libcom_err.a
-#	$(CHMOD) 444 $(DESTDIR)$(LIBDIR)/libcom_err.a
+#	$(LIBTOOL) --mode=install $(INSTALL) -m 644 libcom_err.la $(DESTDIR)$(LIBDIR)
 ## 
 
-libcom_err.o:	$(LIBOBJS)
-	ld -r -s -o libcom_err.o $(LIBOBJS)
-	chmod -x libcom_err.o
+libcom_err.lo:	$(LIBOBJS)
+	$(LIBTOOL) --mode=link --tag=CC ld -r -o libcom_err.lo $(LIBOBJS)
 
 TAGS:	et_name.c error_message.c compile_et.c error_table.c \
 		lex.yy.c init_et.c
--- cyrus-imapd-2.3.12p2/syslog/Makefile.in~	2008-03-24 22:15:59.000000000 +0200
+++ cyrus-imapd-2.3.12p2/syslog/Makefile.in	2008-09-23 22:13:49.520393331 +0300
@@ -44,12 +44,14 @@
 # $Id$
 
 srcdir = @srcdir@
+top_builddir = @top_builddir@
 VPATH = @srcdir@
 
 CC = @CC@
 
 INSTALL = @INSTALL@
 RANLIB = @RANLIB@
+LIBTOOL = @LIBTOOL@
 
 DEFS = @DEFS@
 CPPFLAGS = @CPPFLAGS@
@@ -61,23 +63,22 @@
 SHELL = /bin/sh
 MAKEDEPEND = @MAKEDEPEND@
 
-all: libsyslog.a syslogd
+all: libsyslog.la syslogd
 
 install:
 	@echo "Install syslogd and syslog.conf as appropriate"
 
-.c.o:
-	$(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) $(CFLAGS) $<
+%.lo: %.c
+	$(LIBTOOL) --mode=compile --tag=CC $(CC) -c $(CPPFLAGS) $(DEFS) -I$(srcdir) $(CFLAGS) $<
 
-libsyslog.a: syslog.o
-	ar cr libsyslog.a syslog.o
-	$(RANLIB) libsyslog.a
+libsyslog.la: syslog.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) -o libsyslog.la syslog.lo
 
-syslogd: syslogd.o
-	$(CC) $(LDFLAGS) -o syslogd syslogd.o $(LIBS)
+syslogd: syslogd.lo
+	$(LIBTOOL) --mode=link --tag=CC $(CC) $(LDFLAGS) -o syslogd syslogd.lo $(LIBS)
 
 clean:
-	rm -f *.o *.a Makefile.bak
+	rm -rf .libs *.o *.lo *.a *.la Makefile.bak
 
 distclean: clean
 	rm -f Makefile
--- cyrus-imapd-2.3.12p2/makedepend/configure.in	2008-09-23 22:16:22.353226136 +0300
+++ cyrus-imapd-2.3.12p2/makedepend/configure.in	2008-09-23 22:20:08.678306577 +0300
@@ -2,7 +2,7 @@
 AC_INIT(cppsetup.c)
 AC_PROG_CC
 AC_PROG_INSTALL
-AC_PROG_RANLIB
+AC_PROG_LIBTOOL
 AC_PROG_MAKE_SET
 AC_CHECK_HEADERS(stdarg.h)
 AC_SUBST(CPPFLAGS)
